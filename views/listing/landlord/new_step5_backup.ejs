<% include ../../partials/header %>


<div class="container" style="text-align: center; margin-bottom: 10px">
  <h3>Listing room/house</h3>  
</div>

<div class="container">
<!-- totalSteps and curr_step should be provided -->
	<%var curr_step=5; 
	  var totalSteps=6;
	  var action_url="/listing/landlord/new";
	  var action_method="POST";
	  var title = "Set the scenes for online tour"%>
	<% include ../../partials/stepwizard_header %>

	<link rel="stylesheet" href="/stylesheets/file_upload_v1.css">
	
     	<!--<div class="row text-center">-->
        <% for (var picIndex=1; picIndex<=1; picIndex++) {
	    if (picIndex%2) {%>
		<div class="row text-center" style="display:flex; flex-wrap: wrap;">
		<% } %>
            <div class="col-md-6">
				<div class="d-flex flex-column">
				    <div class="avatar-upload" id="<%=`avatar-upload-${picIndex}`%>">
	
				        <div class="avatar-edit" id="<%=`avatar-edit-${picIndex}`%>" onmouseover="handleOnMouseHooverImagePreview(this, <%=`${picIndex}`%>)">
				            <label for="<%=`imageUpload-${picIndex}`%>" id="<%=`editLabel-${picIndex}`%>"></label>
				        </div>

				        <div class="avatar-delete" id="<%=`avatar-delete-${picIndex}`%>" onmouseover="handleOnMouseHooverImagePreview(this, <%=`${picIndex}`%>)">
				            <label for="<%=`imageUpload-${picIndex}`%>" id="<%=`deleteLabel-${picIndex}`%>"></label>
				        </div>

				        <div class="avatar-preview">
				            <div id="<%=`imagePreview-${picIndex}`%>"  onmouseover="handleOnMouseHooverImagePreview(this, <%=`${picIndex}`%>)" onmouseout="handleOnMouseOutImagePreview(this, <%=`${picIndex}`%>)">
					                <input type='file' name="file_name" id="<%=`imageDefaultUpload-${picIndex}`%>" onchange="readURL(this, <%=`${picIndex}`%>)" accept=".png, .jpg, .jpeg"/>
					                <label class="pictureAddLabel" id="<%=`previewLabel-${picIndex}`%>" for="<%=`imageDefaultUpload-${picIndex}`%>" style="opacity: 1">+</label>
				            </div>
				        </div>


	                    <div class="caption">
				        	<input type="text" id="<%=`imageCapture-${picIndex}`%>" placeholder="Add Caption" ></input>
						</div>
			    	</div>
                </div>
            </div>
	<% if (picIndex%2==0) { %>
    	</div>
    <% } %>
        <% } %>


       	<div class="p-2" style="display: none;">
       		<input type="text" id="debug" value="debug messages" style="display:inline-block"></input>
		<hr>
			<button class="btn btn-success btn-lg float-left" type="submit" name="submit" value="prev">Prev</button>
			<button class="btn btn-primary nextBtn btn-lg float-right" type="submit" name="submit" value="step#3">Next</button>
		</div>
</div>


<script>
var nextPictureIndex = 1;

// set display to none except the first

for (var pictureIndex =1; pictureIndex <=4; pictureIndex++)
{
	if(pictureIndex>1)
	{
		var picturePreviewId = document.getElementById(`avatar-upload-${pictureIndex}`);
		picturePreviewId.style.display = "none";
	}
}

function handleOnMouseHooverImagePreview(elementId, picIndex) {
    var previewLabelId = document.getElementById(`previewLabel-${picIndex}`);

    var debugElementId = document.getElementById("debug");
    
    if(previewLabelId.style.opacity==0)
    {
        var avatarDeleteId = document.getElementById(`avatar-delete-${picIndex}`);
        avatarDeleteId.style.display = "inline-block";
    }

    if(previewLabelId.style.opacity==0) {
        var labelElementId = document.getElementById(`editLabel-${picIndex}`);
        labelElementId.style.opacity = 1;


        labelElementId = document.getElementById(`deleteLabel-${picIndex}`);
        labelElementId.style.opacity = 1;
    }
}

function handleOnMouseOutImagePreview(elementId, picIndex) {
    var previewLabelId = document.getElementById(`previewLabel-${picIndex}`);

    if(previewLabelId.style.opacity==0) {
        var labelElementId = document.getElementById(`editLabel-${picIndex}`);
        labelElementId.style.opacity = 0;

        var labelElementId = document.getElementById(`deleteLabel-${picIndex}`);
        labelElementId.style.opacity = 0;
    }

}

function readURL(input, picIndex) {

	var submitFormElement = document.getElementById(`file-upload-form-${picIndex}`);
	submitFormElement.submit();

    var debugElementId = document.getElementById("debug");

    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $(`#imagePreview-${picIndex}`).css('background-image', 'url('+e.target.result +')');
            $(`#imagePreview-${picIndex}`).hide();
            $(`#imagePreview-${picIndex}`).fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);

	    $(`#previewLabel-${picIndex}`).css('opacity', 0);

	    nextPictureIndex++;
	    var picturePreviewId = document.getElementById(`avatar-upload-${nextPictureIndex}`);
		picturePreviewId.style.display = "inline-block";

		
    } 

}

</script>

<% include ../../partials/footer %>